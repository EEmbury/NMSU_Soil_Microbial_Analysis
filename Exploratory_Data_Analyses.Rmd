---
title: '<span style = ''font-size:14pt;''>**Microbial Communities in the changing vegetation of the Chihuahuan Desert 
**</span>'
subtitle: '<span style = ''font-size:12pt;''>Exploratory Data Analyses
</span>'
author: "Emily Embury"
date: "`r Sys.Date()`"
output: pdf_document
---
<style type="text/css">
/* Whole document: */ 
body{
  font-size: 12pt;
}
/* Headers */
h1{
  font-size: 12pt;
}
</style>

---

```{r include = FALSE}
knitr::opts_chunk$set(
  echo = TRUE,              
  warning = FALSE,       
  message = FALSE,  
  cache = FALSE,        
  fig.align = "center", 
  fig.height = 4,
  fig.width = 6,
  class.source="bg-warning",
  class.output="bg-success"
)

```

# **Soil Temperature**

- Soil temperature measurements

- Soil temperature was measured using a temperature probe at a depth of 3.75in.

- A, B, C correspond with replicates within plots


```{r}
soil_temp <- read.csv("Raw_data/soil_temp/Soil_temperature_2.csv")

#get standard deviation for error bars
library(Rmisc)
soil_temp_sum <- summarySE(soil_temp, measurevar = "Celsius", groupvars=c("Month","Vegetation"))

#plot monthly averages
library(ggplot2)

ggplot(soil_temp_sum, aes(x=factor(Vegetation, 
                                   level=c('Grass', 
                                           'Mesquite_Grass', 
                                           'Mesquite')), #change order of x-axis
                          y=Celsius))+
  geom_bar(position="dodge", stat="identity")+
  facet_wrap(~factor(Month, levels = c("October", "January", "March", 
                                       "May", "July")))+
  xlab("Vegetation") + # change x axis label
  ylab("Temperature (C)") +# change y axis label
  geom_errorbar(aes(ymin=Celsius-se, ymax=Celsius+se), width=.1) 

#add error bars


```


# **Soil pH**

- There were issues with the pH soil probe so all data using that probe will not be included in any analyses

- All pH measurements are from soil samples sent to RegenAg


```{r}
soil_ph <- read.csv("Raw_data/soil_chem/ph_for_r.csv", header = TRUE)

#plot data
library(ggplot2)

pH_plot <- ggplot(soil_ph, aes(x=factor(Vegetation, 
                                   level=c('Grass', 
                                           'Mesquite-Grass', 
                                           'Mesquite')), #change order of x-axis
                          y=pH))+
  geom_boxplot()+
  facet_wrap(~factor(Month, levels = c("October", "January", "March", 
                                       "May", "July")))+
  stat_summary(fun.y=mean, geom="point", shape=23, color="red", fill="yellow") +
  xlab("Vegetation") + # change x axis label
  ylab("pH") # change y axis label

#add P values
library(ggpubr)
library(tidyverse)

mycomparisons_veg <- list(c("Grass", "Mesquite-Grass"),
                          c("Mesquite",  "Mesquite-Grass"), 
                          c("Grass", "Mesquite")) #groupings for ANOVA

pH_plot + stat_compare_means(comparisons = mycomparisons_veg, size = 3, label.y = 5, step.increase = .3)+
  stat_compare_means(method = "anova", label.y = 1, size = 3) # add anova values to plot
```



# **C:N Levels**

- All C:N measurements are from soil samples sent to RegenAg


```{r}
soil_CN <- read.csv("Raw_data/soil_chem/C_N_for_r.csv", header = TRUE)

#add column of C:N ratio
soil_CN <- transform(soil_CN, C_N = soil_CN$C / soil_CN$N)

#plot C:N ratio
library(ggplot2)

CN_plot <- ggplot(soil_CN, aes(x=factor(Vegetation, 
                                   level=c('Grass', 
                                           'Mesquite-Grass', 
                                           'Mesquite')), #change order of x-axis
                          y=C_N))+
  geom_boxplot()+
  facet_wrap(~factor(Month, levels = c("October", "January", "March", 
                                       "May", "July")))+
  stat_summary(fun.y=mean, geom="point", shape=23, color="red", fill="yellow") +
  xlab("Vegetation") + # change x axis label
  ylab("C:N")+ # change y axis label
  ylim(0, 17) #change y-axis scale so p values can fit in plot


#add P values
library(ggpubr)
library(tidyverse)

mycomparisons_veg <- list(c("Grass", "Mesquite-Grass"),
                          c("Mesquite",  "Mesquite-Grass"), 
                          c("Grass", "Mesquite")) #groupings for ANOVA

CN_plot + stat_compare_means(comparisons = mycomparisons_veg, size = 3, step.increase = .19)+
  stat_compare_means(method = "anova", label.y = 1, size = 3) # add anova values to plot
```

# **PLFA**

- Phospholipid Fatty Acid Analysis


```{r}
PLFA_fun_bac <- read.csv("PLFA_fun_bac.csv")

#add a column that connects microbe to month
PLFA_fun_bac$interaction2 <- factor(interaction(PLFA_fun_bac$Type, PLFA_fun_bac$Month),
                                   levels = c("Bacteria.October","Bacteria.March",
                                              "Bacteria.January", 
                                              "Fungi.October","Fungi.March",
                                              "Fungi.January"))

PLFA_plot <- ggplot(PLFA_fun_bac,
            aes(x=interaction2, y = Total_Percent_Biomass,
                fill = factor(Month, levels = c("October", "January", "March")))) + #change bar order
  geom_boxplot()+
  facet_wrap(~factor(Field.ID, levels=c('Grass', 'Mesquite_Grass', 'Mesquite')))+
  scale_y_continuous(labels = scales::percent_format(scale = 1))+ # change y-axis to percentage
  theme(axis.title.x = element_blank(), axis.text.x = element_text( vjust = 0.5), axis.ticks.x = element_blank()) + #remove x-axis title
  ylab("% of Total Biomass")+ # change y axis label
  ggtitle ("% of Fungi and Bacteria in Total Biomass Across 
  Vegetation Types and Sampleing Periods") + #change title
  #theme( text = element_text(size = 20)) + # change sizes for poster presentation
  scale_fill_manual(values=c("October" ="#c04d27", "January" = "#edba1d", "March" = "#47c0c4"), name = "Month") #add custom colors and change legend name

#comparisons for p values
PLFA_comparisons <- list(c("Bacteria.October","Bacteria.March"),
                       c("Bacteria.January", "Bacteria.March"),
                       c("Bacteria.October", "Bacteria.January"),
                       c("Fungi.October","Fungi.March"),
                       c("Fungi.January", "Fungi.March"),
                       c("Fungi.October", "Fungi.January"))


PLFA_plot +  stat_compare_means(comparisons = PLFA_comparisons, size =3) +
  scale_x_discrete(labels=c("Bacteria.October" = " ", "Bacteria.March" = "Bacteria", "Bacteria.January" = " ",
                              "Fungi.October" = " ", "Fungi.March" = "Fungi", "Fungi.January" = " ",
                              "Bacteria.October" = " ", "Bacteria.March" = "Bacteria", "Bacteria.January" = " ",
                              "Fungi.October" = " ", "Fungi.March" = "Fungi", "Fungi.January" = " ",
                              "Bacteria.October" = " ", "Bacteria.March" = "Bacteria", "Bacteria.January" = " ",
                              "Fungi.October" = "", "Fungi.March" = "Fungi", "Fungi.January" = "")) 

```


# **Respiration**

- Respiration measured from litter bags
- Litter bags placed into Mason jar respiration chambers and incubated for 45 minutes
- Calculations:
  - How to transform CO2 data in ppm to rate of CO2 g-1 of biomass h-1
    - You have:
      - CO2start (ppm = umol/mol)
      - CO2end (umol/mol)
      - Interval (hr)
      - Volume of air in jar = Total volume of jar minus volume of biomass (ml) (for example if we have a jar of 25 mls and we have 5 mls of media, then the volume of the air would be 20 mls).
      - Density of CO2 at STP = 44.0 gr/22400 ml

  - CO2 flux = (CO2end-CO2start) / interval * Volume * Density
  - The units will be CO2grams hr-1. You can then divide by the biomass to your desired result.


```{r}
respiration <- read.csv("Raw_data/respiration/CO2_adjusted_w_start.csv")


# CO2_measure_for_R is values without adjusting for start CO2
# CO2_raw.csv is values in jar without adjusting for biomass and not including start C02
# CO2_adjust_w_start is values adjusted for biomass and start CO2
# CO2_site is values of empty jar

respiration_plot <- ggplot(respiration, aes(x=factor(Vegetation, 
                                   level=c('Grass', 
                                           'Mesquite Grass', 
                                           'Mesquite')), y=Respiration, fill = Vegetation))  + #plot CO2 by vegetation type
  geom_boxplot(lwd=.8)  + # add box plot
  theme_bw()+ # remove grey background
  facet_wrap(~Month)+ #group by month
  ylab("CO2 g-1 of biomass h-1")+ # change y axis label
  xlab("Vegetation")+
  ggtitle ("CO2 Measurements Across Seasons and Vegetation")+ #change title
  scale_fill_manual(values=c("Mesquite" ="#c04d27", "Grass" = "#edba1d", "Mesquite Grass" = "#47c0c4"))#add custom colors 

  

mycomparisons <- list( c("Grass", "Mesquite Grass"),  c("Mesquite", "Mesquite Grass"), c("Grass", "Mesquite")) #groupings for ANOVA

respiration_plot + stat_compare_means(comparisons = mycomparisons, size =3)

```


# **Litter Decomposition**

Mass loss from litter bags


Collection Periods:

  - a = 87 days of decomposition
  - b = 145 days of decomposition
  - c = 207 days of decomposition
  - d = 269 days of decomposition

```{r}
litter <- read.csv("Raw_data/litter/Litter_bags_rm_open.csv")

library(ggplot2)

#get standard deviation for error bars
library(Rmisc)
litter_sum <- summarySE(litter, measurevar = "Biomass_change", groupvars=c("Collection_period","Vegetation"))


litter_plot <- ggplot(litter_sum, aes(x= Collection_period, y = Biomass_change, group = Vegetation))+
  geom_line(aes(color=Vegetation))+
  geom_point()+
  xlab("Collection Period") + # change x axis label
  ylab("Average Change in Biomass (g)")+ # change y axis label
  scale_color_manual(values=c("Mesquite" ="#c04d27", "Grass" = "#edba1d", "Mesquite-Grass" = "#47c0c4"))+ #add custom colors
  geom_errorbar(aes(ymin=Biomass_change-se, ymax=Biomass_change+se, color = Vegetation), width=.1) 
  
litter_plot


```

